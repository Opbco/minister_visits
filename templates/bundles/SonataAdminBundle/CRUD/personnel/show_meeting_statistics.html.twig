{% extends '@SonataAdmin/CRUD/base_show_field.html.twig' %}
{% block field %}
	{% set totalMeetings = object.myReunions|length %}
	{% set attendedMeetings = object.myReunions|filter(p => p.status.value == 'attended')|length %}
	{% set absentMeetings = object.myReunions|filter(p => p.status.value == 'absent')|length %}
	{% set excusedMeetings = object.myReunions|filter(p => p.status.value == 'excused')|length %}
	{% set pendingMeetings = object.myReunions|filter(p => p.status.value == 'invited')|length %}
	{% set presidentCount = object.myReunions|filter(p => p.reunion.president == object)|length %}

	<div class="info-box bg-aqua">
		<span class="info-box-icon">
			<i class="fa fa-calendar"></i>
		</span>
		<div class="info-box-content">
			<span class="info-box-text">Total Meetings</span>
			<span class="info-box-number">{{ totalMeetings }}</span>
		</div>
	</div>

	<div class="info-box bg-green">
		<span class="info-box-icon">
			<i class="fa fa-check"></i>
		</span>
		<div class="info-box-content">
			<span class="info-box-text">Attended</span>
			<span class="info-box-number">{{ attendedMeetings }}</span>
			<div class="progress">
				<div class="progress-bar" style="width: {{ totalMeetings > 0 ? (attendedMeetings / totalMeetings * 100)|round : 0 }}%"></div>
			</div>
			<span class="progress-description">
				{{ totalMeetings > 0 ? ((attendedMeetings / totalMeetings * 100)|round) : 0 }}% attendance rate
			</span>
		</div>
	</div>

	<div class="info-box bg-red">
		<span class="info-box-icon">
			<i class="fa fa-times"></i>
		</span>
		<div class="info-box-content">
			<span class="info-box-text">Absent</span>
			<span class="info-box-number">{{ absentMeetings }}</span>
		</div>
	</div>

	<div class="info-box bg-yellow">
		<span class="info-box-icon">
			<i class="fa fa-exclamation"></i>
		</span>
		<div class="info-box-content">
			<span class="info-box-text">Excused</span>
			<span class="info-box-number">{{ excusedMeetings }}</span>
		</div>
	</div>
{% endblock %}
