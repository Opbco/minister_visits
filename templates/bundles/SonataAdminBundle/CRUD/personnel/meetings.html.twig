{% extends '@SonataAdmin/standard_layout.html.twig' %}

{% block title %}
    Meetings - {{ object.nomComplet }}
{% endblock %}

{% block content %}
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">
                <i class="fa fa-calendar"></i>
                Meeting Participation - {{ object.nomComplet }}
            </h3>
            <div class="box-tools pull-right">
                <a href="{{ admin.generateObjectUrl('show', object) }}" class="btn btn-sm btn-default">
                    <i class="fa fa-arrow-left"></i> Back to Profile
                </a>
                <a href="{{ admin.generateObjectUrl('edit', object) }}" class="btn btn-sm btn-primary">
                    <i class="fa fa-edit"></i> Edit Personnel
                </a>
            </div>
        </div>
    </div>

    {# Statistics Boxes #}
    <div class="row">
        <div class="col-md-2">
            <div class="info-box bg-aqua">
                <span class="info-box-icon"><i class="fa fa-calendar"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Total</span>
                    <span class="info-box-number">{{ statistics.total }}</span>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="info-box bg-green">
                <span class="info-box-icon"><i class="fa fa-check"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Attended</span>
                    <span class="info-box-number">{{ statistics.attended }}</span>
                    <span class="progress-description">{{ statistics.attendanceRate }}% rate</span>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="info-box bg-yellow">
                <span class="info-box-icon"><i class="fa fa-clock-o"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Upcoming</span>
                    <span class="info-box-number">{{ statistics.upcoming }}</span>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="info-box bg-red">
                <span class="info-box-icon"><i class="fa fa-gavel"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">As President</span>
                    <span class="info-box-number">{{ statistics.asPresident }}</span>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="info-box bg-gray">
                <span class="info-box-icon"><i class="fa fa-times"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Absent</span>
                    <span class="info-box-number">{{ statistics.absent }}</span>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="info-box bg-purple">
                <span class="info-box-icon"><i class="fa fa-percent"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Attendance</span>
                    <span class="info-box-number">{{ statistics.attendanceRate }}%</span>
                </div>
            </div>
        </div>
    </div>

    {# Meetings Table #}
    <div class="box box-info">
        <div class="box-header with-border">
            <h3 class="box-title">All Meetings</h3>
            <div class="box-tools">
                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="box-body">
            {% if participations|length > 0 %}
                <table class="table table-striped table-hover table-bordered">
                    <thead>
                        <tr>
                            <th width="120">Date</th>
                            <th>Meeting</th>
                            <th>Location</th>
                            <th>Organizer</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Meeting Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for participation in participations %}
                            {% set meeting = participation.reunion %}
                            <tr class="{% if meeting.isUpcoming %}info{% elseif participation.status.value == 'absent' %}danger{% endif %}">
                                <td>
                                    <i class="fa fa-calendar"></i>
                                    <strong>{{ meeting.dateDebut|date('d/m/Y') }}</strong><br>
                                    <small class="text-muted">{{ meeting.dateDebut|date('H:i') }} - {{ meeting.dateFin|date('H:i') }}</small>
                                </td>
                                <td>
                                    <strong>{{ meeting.objet }}</strong><br>
                                    {% if meeting.type %}
                                        <span class="label label-default">{{ meeting.type }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <i class="fa fa-map-marker"></i>
                                    {{ meeting.locationDisplay }}
                                </td>
                                <td>
                                    <small>{{ meeting.organisateur.nameFr }}</small>
                                </td>
                                <td>
                                    {% if meeting.president == object %}
                                        <span class="label label-danger">
                                            <i class="fa fa-gavel"></i> President
                                        </span>
                                    {% else %}
                                        <span class="label label-info">
                                            <i class="fa fa-users"></i> Participant
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% set status = participation.status.value %}
                                    {% if status == 'attended' %}
                                        <span class="label label-success"><i class="fa fa-check"></i> Attended</span>
                                    {% elseif status == 'absent' %}
                                        <span class="label label-danger"><i class="fa fa-times"></i> Absent</span>
                                    {% elseif status == 'excused' %}
                                        <span class="label label-warning"><i class="fa fa-exclamation"></i> Excused</span>
                                    {% elseif status == 'confirmed' %}
                                        <span class="label label-primary"><i class="fa fa-check-circle"></i> Confirmed</span>
                                    {% else %}
                                        <span class="label label-default"><i class="fa fa-envelope"></i> Invited</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% set mStatus = meeting.statut.value %}
                                    {% if mStatus == 'completed' %}
                                        <span class="label label-success">Completed</span>
                                    {% elseif mStatus == 'cancelled' %}
                                        <span class="label label-danger">Cancelled</span>
                                    {% elseif mStatus == 'postponed' %}
                                        <span class="label label-warning">Postponed</span>
                                    {% elseif meeting.isUpcoming %}
                                        <span class="label label-info">Upcoming</span>
                                    {% else %}
                                        <span class="label label-default">{{ mStatus|title }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {# Link to view meeting in ReunionAdmin #}
                                    <a href="/admin/app/reunion/{{ meeting.id }}/show" 
                                        class="btn btn-xs btn-primary" 
                                        title="View meeting details">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-info">
                    <i class="fa fa-info-circle"></i>
                    <strong>No meetings found.</strong>
                    This person has not participated in any meetings yet.
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
