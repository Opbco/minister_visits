{% extends '@SonataAdmin/standard_layout.html.twig' %}

{% block title %}
    Action Items - {{ object.nomComplet }}
{% endblock %}

{% block content %}
    <div class="box box-warning">
        <div class="box-header with-border">
            <h3 class="box-title">
                <i class="fa fa-tasks"></i>
                Action Items - {{ object.nomComplet }}
            </h3>
            <div class="box-tools pull-right">
                <a href="{{ admin.generateObjectUrl('show', object) }}" class="btn btn-sm btn-default">
                    <i class="fa fa-arrow-left"></i> Back to Profile
                </a>
                <a href="{{ admin.generateObjectUrl('edit', object) }}" class="btn btn-sm btn-primary">
                    <i class="fa fa-edit"></i> Edit Personnel
                </a>
            </div>
        </div>
    </div>

    {# Statistics Boxes #}
    <div class="row">
        <div class="col-md-2">
            <div class="small-box bg-blue">
                <div class="inner">
                    <h3>{{ statistics.total }}</h3>
                    <p>Total Actions</p>
                </div>
                <div class="icon"><i class="fa fa-tasks"></i></div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="small-box bg-yellow">
                <div class="inner">
                    <h3>{{ statistics.pending }}</h3>
                    <p>Pending</p>
                </div>
                <div class="icon"><i class="fa fa-hourglass-half"></i></div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>{{ statistics.inProgress }}</h3>
                    <p>In Progress</p>
                </div>
                <div class="icon"><i class="fa fa-spinner"></i></div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="small-box bg-green">
                <div class="inner">
                    <h3>{{ statistics.completed }}</h3>
                    <p>Completed</p>
                </div>
                <div class="icon"><i class="fa fa-check-circle"></i></div>
                <div class="small-box-footer">{{ statistics.completionRate }}% rate</div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="small-box {% if statistics.overdue > 0 %}bg-red{% else %}bg-gray{% endif %}">
                <div class="inner">
                    <h3>{{ statistics.overdue }}</h3>
                    <p>Overdue</p>
                </div>
                <div class="icon"><i class="fa fa-warning"></i></div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="small-box bg-purple">
                <div class="inner">
                    <h3>{{ statistics.completionRate }}%</h3>
                    <p>Completion</p>
                </div>
                <div class="icon"><i class="fa fa-percent"></i></div>
            </div>
        </div>
    </div>

    {% if statistics.overdue > 0 %}
        <div class="alert alert-danger">
            <h4><i class="fa fa-warning"></i> Alert!</h4>
            This person has <strong>{{ statistics.overdue }}</strong> overdue action item{{ statistics.overdue > 1 ? 's' : '' }} requiring immediate attention.
        </div>
    {% endif %}

    {# Action Items Table #}
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">All Action Items</h3>
        </div>
        <div class="box-body">
            {% if actionItems|length > 0 %}
                <table class="table table-striped table-hover table-bordered">
                    <thead>
                        <tr>
                            <th width="35%">Action</th>
                            <th>Meeting</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in actionItems %}
                            {% set isOverdue = item.dateEcheance and item.dateEcheance < date() and item.statut.value != 'completed' %}
                            <tr class="{% if isOverdue %}danger{% elseif item.statut.value == 'completed' %}success{% endif %}">
                                <td>
                                    <strong>{{ item.description }}</strong>
                                    {% if item.commentaire %}
                                        <br><small class="text-muted">
                                            <i class="fa fa-comment"></i> {{ item.commentaire|slice(0, 100) }}
                                        </small>
                                    {% endif %}
                                </td>
                                <td>
                                    <i class="fa fa-calendar"></i>
                                    {{ item.reunion.objet|slice(0, 50) }}<br>
                                    <small class="text-muted">{{ item.reunion.dateDebut|date('d/m/Y') }}</small>
                                </td>
                                <td>
                                    {% if item.dateEcheance %}
                                        <i class="fa fa-clock-o"></i>
                                        {{ item.dateEcheance|date('d/m/Y') }}
                                        {% if isOverdue %}
                                            <br><span class="label label-danger">
                                                <i class="fa fa-warning"></i> OVERDUE
                                            </span>
                                        {% elseif item.dateEcheance < date('+7 days') and item.statut.value != 'completed' %}
                                            <br><span class="label label-warning">
                                                <i class="fa fa-clock-o"></i> Due soon
                                            </span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">No deadline</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% set status = item.statut.value %}
                                    {% if status == 'completed' %}
                                        <span class="label label-success">
                                            <i class="fa fa-check"></i> Completed
                                        </span>
                                    {% elseif status == 'in_progress' %}
                                        <span class="label label-info">
                                            <i class="fa fa-spinner"></i> In Progress
                                        </span>
                                    {% elseif status == 'cancelled' %}
                                        <span class="label label-default">
                                            <i class="fa fa-ban"></i> Cancelled
                                        </span>
                                    {% else %}
                                        <span class="label label-warning">
                                            <i class="fa fa-hourglass"></i> Pending
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small>{{ item.dateCreated|date('d/m/Y H:i') }}</small>
                                </td>
                                <td>
                                    <a href="/admin/app/actionitem/{{ item.id }}/show" 
                                        class="btn btn-xs btn-primary" 
                                        title="View details">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                    <a href="/admin/app/actionitem/{{ item.id }}/edit" 
                                        class="btn btn-xs btn-warning" 
                                        title="Edit">
                                        <i class="fa fa-edit"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-info">
                    <i class="fa fa-info-circle"></i>
                    <strong>No action items found.</strong>
                    This person has not been assigned any action items yet.
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}